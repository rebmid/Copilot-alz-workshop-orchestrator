{
  "pack_id": "alz-v1.0",
  "name": "Azure Landing Zone — V1 Starter",
  "version": "1.3.0",
  "description": "Signal and control definitions for the ALZ enterprise-scale assessment. Maps logical signal names to signal providers registered in the signals/ layer.",

  "signals": {
    "mg_hierarchy": {
      "provider": "arm",
      "query": "management_groups",
      "signal_bus_name": "arm:mg_hierarchy",
      "description": "Management group hierarchy — depth, platform/landing-zone structure",
      "preflight_probe": "management_groups_read"
    },
    "subscriptions": {
      "provider": "arm",
      "query": "subscriptions",
      "signal_bus_name": null,
      "description": "Enabled subscription list for scope targeting",
      "preflight_probe": null
    },
    "policy_assignments": {
      "provider": "policy_insights",
      "query": "assignments",
      "signal_bus_name": "policy:assignments",
      "description": "Policy assignment counts — total, initiative, built-in",
      "preflight_probe": "policy_insights"
    },
    "policy_compliance_summary": {
      "provider": "policy_insights",
      "query": "compliance_summary",
      "signal_bus_name": "policy:compliance_summary",
      "description": "Policy compliance percentage + noncompliant resource count",
      "preflight_probe": "policy_insights"
    },
    "defender_pricings": {
      "provider": "defender",
      "query": "pricings",
      "signal_bus_name": "defender:pricings",
      "description": "Defender for Cloud plan pricing tiers",
      "preflight_probe": "defender_for_cloud"
    },
    "defender_secure_score": {
      "provider": "defender",
      "query": "secure_score",
      "signal_bus_name": "defender:secure_score",
      "description": "Microsoft Defender secure score percentage",
      "preflight_probe": "defender_for_cloud"
    },
    "diagnostic_settings_sample": {
      "provider": "monitor",
      "query": "diagnostic_coverage",
      "signal_bus_name": "monitor:diag_coverage_sample",
      "description": "Sample-based diagnostics coverage percentage",
      "preflight_probe": null
    },
    "azure_firewalls": {
      "provider": "resource_graph",
      "query": "Resources | where type =~ 'microsoft.network/azurefirewalls'",
      "signal_bus_name": "resource_graph:azure_firewall",
      "description": "Azure Firewall resources across subscriptions",
      "preflight_probe": "resource_graph"
    },
    "vnets": {
      "provider": "resource_graph",
      "query": "Resources | where type =~ 'microsoft.network/virtualnetworks'",
      "signal_bus_name": "resource_graph:vnets",
      "description": "Virtual networks with peerings, subnets, DDoS plan",
      "preflight_probe": "resource_graph"
    },
    "public_ips": {
      "provider": "resource_graph",
      "query": "Resources | where type =~ 'microsoft.network/publicipaddresses'",
      "signal_bus_name": "resource_graph:public_ips",
      "description": "Public IP addresses with SKU and association status",
      "preflight_probe": "resource_graph"
    },
    "route_tables": {
      "provider": "resource_graph",
      "query": "Resources | where type =~ 'microsoft.network/routetables'",
      "signal_bus_name": "resource_graph:route_tables",
      "description": "Route tables for centralized egress verification",
      "preflight_probe": "resource_graph"
    },
    "nsgs": {
      "provider": "resource_graph",
      "query": "Resources | where type =~ 'microsoft.network/networksecuritygroups'",
      "signal_bus_name": "resource_graph:nsgs",
      "description": "Network Security Groups across subscriptions",
      "preflight_probe": "resource_graph"
    },
    "ddos_plans": {
      "provider": "resource_graph",
      "query": "Resources | where type =~ 'microsoft.network/ddosprotectionplans'",
      "signal_bus_name": null,
      "description": "DDoS Protection Plan resources (VNet-level DDoS coverage is on vnets signal)",
      "preflight_probe": "resource_graph"
    },
    "log_analytics_workspaces": {
      "provider": "arm",
      "query": "workspaces",
      "signal_bus_name": null,
      "description": "Log Analytics workspaces for centralized logging validation",
      "preflight_probe": "log_analytics_reader"
    },

    "storage_posture": {
      "provider": "resource_graph",
      "signal_bus_name": "resource_graph:storage_posture",
      "description": "Storage account posture — public access, HTTPS, TLS, network ACLs (coverage-based)",
      "preflight_probe": "resource_graph"
    },
    "keyvault_posture": {
      "provider": "resource_graph",
      "signal_bus_name": "resource_graph:keyvault_posture",
      "description": "Key Vault posture — purge protection, RBAC, soft delete, public access (coverage-based)",
      "preflight_probe": "resource_graph"
    },
    "sql_posture": {
      "provider": "resource_graph",
      "signal_bus_name": "resource_graph:sql_posture",
      "description": "SQL server posture — public network, TLS, Entra-only auth (coverage-based)",
      "preflight_probe": "resource_graph"
    },
    "app_service_posture": {
      "provider": "resource_graph",
      "signal_bus_name": "resource_graph:app_service_posture",
      "description": "App Service posture — HTTPS, TLS, FTPS, managed identity (coverage-based)",
      "preflight_probe": "resource_graph"
    },
    "acr_posture": {
      "provider": "resource_graph",
      "signal_bus_name": "resource_graph:acr_posture",
      "description": "Container Registry posture — SKU, admin user, public access (coverage-based)",
      "preflight_probe": "resource_graph"
    },
    "aks_posture": {
      "provider": "resource_graph",
      "signal_bus_name": "resource_graph:aks_posture",
      "description": "AKS cluster posture — RBAC, network policy, private cluster, managed identity (coverage-based)",
      "preflight_probe": "resource_graph"
    },
    "private_endpoints": {
      "provider": "resource_graph",
      "signal_bus_name": "resource_graph:private_endpoints",
      "description": "Private endpoint coverage — PaaS resources with private link (coverage-based)",
      "preflight_probe": "resource_graph"
    },
    "nsg_coverage": {
      "provider": "resource_graph",
      "signal_bus_name": "resource_graph:nsg_coverage",
      "description": "NSG subnet coverage — subnets with/without NSG, empty NSG anti-pattern (coverage-based)",
      "preflight_probe": "resource_graph"
    },
    "resource_locks": {
      "provider": "resource_graph",
      "signal_bus_name": "resource_graph:resource_locks",
      "description": "Resource lock inventory — lock count and RG-level coverage (coverage-based)",
      "preflight_probe": "resource_graph"
    },
    "backup_coverage": {
      "provider": "resource_graph",
      "signal_bus_name": "resource_graph:backup_coverage",
      "description": "VM backup coverage — VMs with/without Recovery Services protection (coverage-based)",
      "preflight_probe": "resource_graph"
    },
    "rbac_hygiene": {
      "provider": "authorization",
      "signal_bus_name": "identity:rbac_hygiene",
      "description": "RBAC hygiene — owner count, group vs user ratio, service principals (coverage-based)",
      "preflight_probe": null
    },

    "entra_log_availability": {
      "provider": "entra",
      "signal_bus_name": "identity:entra_log_availability",
      "description": "Entra ID log availability — sign-in, audit, SP logs forwarded to Log Analytics (coverage-based)",
      "preflight_probe": "aad_diagnostics"
    },
    "pim_usage": {
      "provider": "entra",
      "signal_bus_name": "identity:pim_usage",
      "description": "PIM usage — role eligibility activations, break-glass detection (coverage-based)",
      "preflight_probe": null
    },

    "workspace_topology": {
      "provider": "monitor",
      "signal_bus_name": "monitor:workspace_topology",
      "description": "Log Analytics workspace topology — workspace count, centralized model, Sentinel presence, retention (coverage-based)",
      "preflight_probe": "log_analytics_reader"
    },
    "activity_log_analysis": {
      "provider": "monitor",
      "signal_bus_name": "monitor:activity_log_analysis",
      "description": "Activity log automation maturity — IaC ratio, policy remediations, RBAC/NSG/FW churn (coverage-based)",
      "preflight_probe": null
    },

    "cost_management_posture": {
      "provider": "cost_management",
      "signal_bus_name": "cost:management_posture",
      "description": "Cost governance — budgets, cost alerts, reservation/savings plan (coverage-based)",
      "preflight_probe": "cost_management_reader"
    },

    "network_watcher_posture": {
      "provider": "network_watcher",
      "signal_bus_name": "network:watcher_posture",
      "description": "Network Watcher observability — flow logs v2, Traffic Analytics, connection monitors (coverage-based)",
      "preflight_probe": null
    },

    "update_manager": {
      "provider": "maintenance",
      "signal_bus_name": "manage:update_manager",
      "description": "Update Manager posture — maintenance configs, guest configuration, patch assessment, VM maintenance join (coverage-based)",
      "preflight_probe": null
    },

    "pim_maturity": {
      "provider": "graph_api",
      "signal_bus_name": "identity:pim_maturity",
      "description": "PIM maturity — eligible vs permanent role assignments for privileged directory roles via Microsoft Graph",
      "preflight_probe": "graph_api_reader"
    },
    "breakglass_validation": {
      "provider": "graph_api",
      "signal_bus_name": "identity:breakglass_validation",
      "description": "Break-glass account validation — emergency access accounts detected, CA excluded, recently tested",
      "preflight_probe": "graph_api_reader"
    },
    "sp_owner_risk": {
      "provider": "resource_graph",
      "signal_bus_name": "identity:sp_owner_risk",
      "description": "Service principal owner risk — SPs with Owner or User Access Administrator role (coverage-based)",
      "preflight_probe": "resource_graph"
    },
    "admin_ca_coverage": {
      "provider": "graph_api",
      "signal_bus_name": "identity:admin_ca_coverage",
      "description": "Admin Conditional Access coverage — admin users protected by CA policies requiring MFA",
      "preflight_probe": "graph_api_reader"
    },

    "alert_action_mapping": {
      "provider": "resource_graph",
      "signal_bus_name": "monitor:alert_action_mapping",
      "description": "Alert to action group mapping — metric and scheduled query alerts with/without action groups",
      "preflight_probe": "resource_graph"
    },
    "action_group_coverage": {
      "provider": "arm",
      "signal_bus_name": "monitor:action_group_coverage",
      "description": "Action group coverage — receiver types (email, webhook, logic app/function) across action groups",
      "preflight_probe": null
    },
    "availability_signals": {
      "provider": "arm",
      "signal_bus_name": "monitor:availability_signals",
      "description": "SLO/availability signals — Service Health alerts, Resource Health alerts, smart detector rules",
      "preflight_probe": null
    },
    "change_tracking": {
      "provider": "arm",
      "signal_bus_name": "monitor:change_tracking",
      "description": "Change tracking — Microsoft.ChangeAnalysis RP registration, ChangeTracking solutions, VM extensions",
      "preflight_probe": null
    },

    "cost_forecast_accuracy": {
      "provider": "cost_management",
      "signal_bus_name": "cost:forecast_accuracy",
      "description": "Cost forecast accuracy — actual vs forecast cost delta, predictability metric",
      "preflight_probe": "cost_management_reader"
    },
    "idle_resources": {
      "provider": "resource_graph",
      "signal_bus_name": "cost:idle_resources",
      "description": "Idle resource detection — Advisor cost recommendations for underutilized VMs, estimated savings",
      "preflight_probe": "resource_graph"
    }
  }
}
