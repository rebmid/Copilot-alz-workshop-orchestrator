<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Azure Landing Zone &ndash; CSA Decision-Driven Assessment</title>
<style>
/* ── CSS Variables ─────────────────────────────────────────── */
:root {
  --bg:       #ffffff;
  --card-bg:  #f6f8fa;
  --border:   #d0d7de;
  --accent:   #0969da;
  --danger:   #cf222e;
  --warn:     #9a6700;
  --success:  #1a7f37;
  --muted:    #656d76;
  --text:     #1f2328;
  --surface:  #eaeef2;
  --font:     -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
}
*, *::before, *::after { box-sizing: border-box; }
html { scroll-behavior: smooth; }
body {
  margin: 0; padding: 0;
  font-family: var(--font);
  background: var(--bg); color: var(--text);
  font-size: 14px; line-height: 1.5;
}

/* ── Layout ────────────────────────────────────────────────── */
.container { max-width: 1280px; margin: 0 auto; padding: 0 24px; }
section { padding: 2rem 0; border-bottom: 1px solid var(--border); }
section:last-of-type { border-bottom: none; }
h1, h2, h3, h4 { margin: 0 0 .5rem 0; font-weight: 600; }
h1 { font-size: 1.8rem; color: var(--accent); }
h2 { font-size: 1.4rem; color: var(--accent); padding-bottom: .5rem; border-bottom: 2px solid var(--accent); }
h3 { font-size: 1.15rem; color: var(--text); }
h4 { font-size: 1rem; color: var(--muted); }
p { margin: 0.3rem 0; }

/* ── Navigation ────────────────────────────────────────────── */
nav {
  position: sticky; top: 0; z-index: 100;
  background: var(--card-bg); border-bottom: 1px solid var(--border);
  padding: .6rem 0;
}
nav .container { display: flex; gap: 1.5rem; flex-wrap: wrap; align-items: center; }
nav a {
  color: var(--muted); text-decoration: none; font-size: .85rem; font-weight: 500;
  padding: .25rem .5rem; border-radius: 6px; transition: all .15s;
}
nav a:hover, nav a:focus { color: var(--accent); background: var(--surface); }
.nav-title { color: var(--accent); font-weight: 700; font-size: .95rem; margin-right: .5rem; }

/* ── Cards & Grids ─────────────────────────────────────────── */
.grid-2 { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 1rem; }
.grid-3 { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 1rem; }
.card {
  background: var(--card-bg); border: 1px solid var(--border);
  border-radius: 8px; padding: 1.2rem; transition: border-color .15s;
}
.card:hover { border-color: var(--accent); }
.card-title { font-weight: 600; margin-bottom: .5rem; }

/* ── KPI Tiles ─────────────────────────────────────────────── */
.kpi-row { display: flex; gap: 1rem; flex-wrap: wrap; margin-bottom: 1.5rem; }
.kpi {
  background: var(--surface); border: 1px solid var(--border); border-radius: 8px;
  padding: .8rem 1.2rem; min-width: 140px; text-align: center; flex: 1;
}
.kpi-value { font-size: 1.8rem; font-weight: 700; line-height: 1.2; }
.kpi-label { font-size: .75rem; color: var(--muted); text-transform: uppercase; letter-spacing: .04em; }

/* ── Badges ────────────────────────────────────────────────── */
.badge {
  display: inline-block; padding: .15rem .5rem; border-radius: 10px;
  font-size: .7rem; font-weight: 600; text-transform: uppercase;
}
.badge-pass   { background: rgba(63,185,80,.15); color: var(--success); }
.badge-fail   { background: rgba(248,81,73,.15); color: var(--danger); }
.badge-partial{ background: rgba(210,153,34,.15); color: var(--warn); }
.badge-manual { background: rgba(139,148,158,.15); color: var(--muted); }
.badge-critical { background: rgba(248,81,73,.25); color: var(--danger); font-weight: 700; }
.badge-high   { background: rgba(230,126,34,.2); color: #e67e22; }
.badge-medium { background: rgba(241,196,15,.15); color: var(--warn); }
.badge-low    { background: rgba(63,185,80,.1); color: var(--success); }
.badge-confirmed { background: rgba(88,166,255,.15); color: var(--accent); }
.badge-derived   { background: rgba(210,153,34,.15); color: var(--warn); }
.badge-assumed   { background: rgba(139,148,158,.15); color: var(--muted); }

/* ── Tags ──────────────────────────────────────────────────── */
.tag {
  display: inline-block; padding: .1rem .45rem; border-radius: 4px;
  font-size: .7rem; color: var(--muted); border: 1px solid var(--border); margin: .1rem;
}

/* ── Trajectory bar ────────────────────────────────────────── */
.trajectory-bar {
  display: flex; gap: 2px; margin: 1rem 0;
  background: var(--surface); border-radius: 8px; overflow: hidden; height: 36px;
}
.traj-segment {
  display: flex; align-items: center; justify-content: center;
  font-size: .7rem; font-weight: 600; color: var(--bg);
}

/* ── Gate banner ───────────────────────────────────────────── */
.gate-pass {
  background: linear-gradient(135deg, rgba(63,185,80,.12), rgba(63,185,80,.04));
  border: 2px solid var(--success); border-radius: 12px; padding: 1.5rem; text-align: center;
}
.gate-fail {
  background: linear-gradient(135deg, rgba(248,81,73,.12), rgba(248,81,73,.04));
  border: 2px solid var(--danger); border-radius: 12px; padding: 1.5rem; text-align: center;
}
.gate-icon { font-size: 2.5rem; }
.gate-headline { font-size: 1.3rem; font-weight: 700; margin: .5rem 0; }

/* ── Blocker list ──────────────────────────────────────────── */
.blocker-item {
  background: var(--surface); border-left: 3px solid var(--danger);
  border-radius: 0 6px 6px 0; padding: .8rem 1rem; margin-bottom: .5rem;
}
.blocker-item.improvement {
  border-left-color: var(--accent);
}

/* ── Risk card layout ──────────────────────────────────────── */
.risk-card {
  background: var(--card-bg); border: 1px solid var(--border);
  border-radius: 8px; padding: 1.2rem; position: relative;
}
.risk-card .risk-header {
  display: flex; align-items: center; gap: .6rem; flex-wrap: wrap; margin-bottom: .7rem;
}
.risk-number {
  width: 28px; height: 28px; border-radius: 50%; display: flex;
  align-items: center; justify-content: center; font-size: .8rem; font-weight: 700;
  background: var(--danger); color: #fff; flex-shrink: 0;
}
.risk-title { font-weight: 600; flex: 1; }
.risk-meta { display: flex; gap: .5rem; flex-wrap: wrap; margin-bottom: .5rem; }

/* ── Phase cards (roadmap) ─────────────────────────────────── */
.phase-card {
  background: var(--card-bg); border: 1px solid var(--border);
  border-radius: 8px; overflow: hidden;
}
.phase-header {
  padding: .8rem 1.2rem; font-weight: 700; font-size: 1rem;
  border-bottom: 1px solid var(--border);
}
.phase-30 .phase-header { background: rgba(248,81,73,.08); color: var(--danger); }
.phase-60 .phase-header { background: rgba(210,153,34,.08); color: var(--warn); }
.phase-90 .phase-header { background: rgba(63,185,80,.08); color: var(--success); }
.phase-item {
  padding: .8rem 1.2rem; border-bottom: 1px solid var(--border);
}
.phase-item:last-child { border-bottom: none; }

/* ── Expandable sections ───────────────────────────────────── */
details { margin-bottom: .5rem; }
details > summary {
  cursor: pointer; padding: .8rem 1rem;
  background: var(--card-bg); border: 1px solid var(--border); border-radius: 8px;
  list-style: none; display: flex; align-items: center; gap: .6rem;
  font-weight: 600; transition: background .15s;
}
details > summary::-webkit-details-marker { display: none; }
details > summary::before {
  content: "\25B8"; display: inline-block; transition: transform .15s;
  font-size: 1rem; width: 1rem;
}
details[open] > summary::before { transform: rotate(90deg); }
details > summary:hover { background: var(--surface); }
details > .detail-body {
  border: 1px solid var(--border); border-top: none;
  border-radius: 0 0 8px 8px; padding: 1rem;
  background: var(--card-bg);
}

/* ── Tables ────────────────────────────────────────────────── */
table {
  width: 100%; border-collapse: collapse; font-size: .82rem;
}
th, td {
  text-align: left; padding: .5rem .6rem;
  border-bottom: 1px solid var(--border);
}
th {
  font-size: .7rem; text-transform: uppercase; letter-spacing: .04em;
  color: var(--muted); background: var(--surface); position: sticky; top: 0;
}
tr:hover td { background: rgba(88,166,255,.04); }
td.why-cell { max-width: 400px; font-size: .78rem; color: var(--muted); }

/* ── Workshop funnel ───────────────────────────────────────── */
.funnel-domain {
  background: var(--card-bg); border: 1px solid var(--border);
  border-radius: 8px; padding: 1.2rem; margin-bottom: 1rem;
}
.funnel-domain h3 { margin-bottom: .8rem; }
.funnel-cols {
  display: grid; grid-template-columns: 1fr 1fr 2fr; gap: 1rem;
}
@media (max-width: 800px) {
  .funnel-cols { grid-template-columns: 1fr; }
}
.funnel-col h4 { font-size: .8rem; text-transform: uppercase; color: var(--muted); margin-bottom: .5rem; }
.funnel-item {
  padding: .4rem .6rem; margin-bottom: .3rem; border-radius: 4px;
  background: var(--surface); font-size: .82rem;
}
.funnel-q { padding: .6rem; background: var(--surface); border-radius: 6px; margin-bottom: .5rem; }
.funnel-q .q-text { font-weight: 600; margin-bottom: .3rem; }
.funnel-q .q-meta { font-size: .78rem; color: var(--muted); }
.impact-row { display: flex; gap: 1rem; margin-top: .3rem; }
.impact-yes { color: var(--success); }
.impact-no { color: var(--danger); }

/* ── Responsive ────────────────────────────────────────────── */
@media (max-width: 900px) {
  .grid-2 { grid-template-columns: 1fr; }
  .grid-3 { grid-template-columns: 1fr; }
  .kpi-row { flex-direction: column; }
}
@media print {
  nav { display: none; }
  body { background: #fff; color: #000; }
  .card, .risk-card, details > summary, .phase-card, .funnel-domain {
    break-inside: avoid;
  }
}
</style>
</head>
<body>

<!-- ═══════════════════ NAVIGATION ═══════════════════════════ -->
<nav>
  <div class="container">
    <span class="nav-title">ALZ Assessment</span>
    <a href="#foundation-gate">Foundation Gate</a>
    <a href="#business-risks">Business Risks</a>
    <a href="#roadmap">Roadmap</a>
    <a href="#design-areas">Design Areas</a>
    <a href="#workshop">Workshop</a>
  </div>
</nav>

<div class="container">

<!-- ═══════════════ S1  FOUNDATION GATE ══════════════════════ -->
<section id="foundation-gate">
  <h2>&sect; 1 &mdash; Foundation Gate</h2>

  {% if foundation_gate.ready %}
  <div class="gate-pass">
    <div class="gate-icon">&#x2705;</div>
    <div class="gate-headline">Ready for Enterprise Scale</div>
    <p style="color:var(--muted)">The platform meets the minimum requirements for enterprise-scale landing zone deployment.</p>
  </div>
  {% else %}
  <div class="gate-fail">
    <div class="gate-icon">&#x1F6AB;</div>
    <div class="gate-headline">Not Yet Ready for Enterprise Scale</div>
    <p style="color:var(--muted)">Critical blockers must be resolved before the platform can support enterprise-scale workloads.</p>
  </div>
  {% endif %}

  <div class="kpi-row" style="margin-top:1.5rem">
    <div class="kpi">
      <div class="kpi-value" style="color:{% if foundation_gate.overall_maturity and foundation_gate.overall_maturity >= 70 %}var(--success){% elif foundation_gate.overall_maturity and foundation_gate.overall_maturity >= 40 %}var(--warn){% else %}var(--danger){% endif %}">
        {{ foundation_gate.overall_maturity|default('--') }}{% if foundation_gate.overall_maturity %}%{% endif %}
      </div>
      <div class="kpi-label">Overall Maturity</div>
    </div>
    <div class="kpi">
      <div class="kpi-value" style="color:var(--accent)">{{ foundation_gate.readiness_score|default('--') }}{% if foundation_gate.readiness_score %}/10{% endif %}</div>
      <div class="kpi-label">Readiness Score</div>
    </div>
    <div class="kpi">
      <div class="kpi-value">{{ foundation_gate.max_subscriptions|default('--') }}</div>
      <div class="kpi-label">Max Subscriptions (Current)</div>
    </div>
    <div class="kpi">
      <div class="kpi-value">{{ foundation_gate.automated_controls }}/{{ foundation_gate.total_controls }}</div>
      <div class="kpi-label">Signal-Backed Controls</div>
    </div>
  </div>

  {% if foundation_gate.blockers %}
  <h3 style="margin-top:1.5rem">&#x1F6A7; Blockers ({{ foundation_gate.blockers|length }})</h3>
  {% for b in foundation_gate.blockers %}
  <div class="blocker-item">
    <div style="display:flex;align-items:center;gap:.5rem;flex-wrap:wrap;margin-bottom:.3rem">
      <strong>{{ b.category }}</strong>
      <span class="badge badge-{{ b.severity|lower }}">{{ b.severity }}</span>
      <span class="badge badge-{{ b.confidence|lower }}">{{ b.confidence }} confidence</span>
    </div>
    <p>{{ b.description }}</p>
    <div style="font-size:.82rem;color:var(--muted);margin-top:.3rem">
      Resolving initiative: <strong>{{ b.resolving_initiative_title }}</strong>
      {% if b.controls_resolved %}
        &middot; {{ b.controls_resolved }} control(s) resolved
      {% endif %}
      {% if b.risks_reduced %}
        &middot; {{ b.risks_reduced }} risk(s) reduced
      {% endif %}
      {% if b.dependencies %}
        &middot; Dependencies: {{ b.dependencies|join(", ") }}
      {% endif %}
    </div>
  </div>
  {% endfor %}
  {% endif %}

  {% if foundation_gate.ready and foundation_gate.improvement_opportunities %}
  <h3 style="margin-top:1.5rem">&#x1F53C; Improvement Opportunities</h3>
  {% for opp in foundation_gate.improvement_opportunities %}
  <div class="blocker-item improvement">
    <p>{{ opp }}</p>
  </div>
  {% endfor %}
  {% endif %}
</section>

<!-- ═══════════════ S2  TOP BUSINESS RISKS ═══════════════════ -->
<section id="business-risks">
  <h2>&sect; 2 &mdash; Top Business Risks</h2>

  {% if risk_cards %}
  <div class="grid-2">
    {% for rc in risk_cards %}
    <div class="risk-card">
      <div class="risk-header">
        <span class="risk-number">{{ loop.index }}</span>
        <span class="risk-title">{{ rc.title }}</span>
      </div>
      <div class="risk-meta">
        <span class="badge badge-{{ rc.risk_level|lower }}">{{ rc.risk_level }}</span>
        <span class="badge badge-{{ rc.signal_badge|lower }}">{{ rc.signal_badge }}</span>
        <span class="badge badge-{{ rc.confidence|lower }}">{{ rc.confidence }} conf</span>
        <span class="tag">{{ rc.design_area }}</span>
        <span class="tag">{{ rc.affected_count }} controls</span>
      </div>

      {% if rc.business_impact %}
      <p style="font-size:.85rem"><strong>Business Impact:</strong> {{ rc.business_impact }}</p>
      {% endif %}
      {% if rc.technical_cause %}
      <p style="font-size:.85rem;color:var(--muted)"><strong>Root Cause:</strong> {{ rc.technical_cause }}</p>
      {% endif %}

      {% if rc.score_drivers %}
      <div style="margin-top:.5rem">
        <span style="font-size:.75rem;color:var(--muted);text-transform:uppercase">Score Drivers</span>
        <div style="margin-top:.2rem">
          {% for d in rc.score_drivers %}
          <span class="tag">{{ d }}</span>
          {% endfor %}
        </div>
      </div>
      {% endif %}

      {% if rc.fix_initiative %}
      <div style="margin-top:.5rem;font-size:.82rem;color:var(--muted)">
        &#x1F527; Fix: <strong>{{ rc.fix_initiative.title }}</strong>
        {% if rc.fix_initiative.blast_radius %}
          &middot; Blast radius: {{ rc.fix_initiative.blast_radius }}
        {% endif %}
      </div>
      {% endif %}
    </div>
    {% endfor %}
  </div>
  {% else %}
  <p style="color:var(--muted)">No business risks identified.</p>
  {% endif %}
</section>

<!-- ═══════════════ S3  30 / 60 / 90  ROADMAP ═══════════════ -->
<section id="roadmap">
  <h2>&sect; 3 &mdash; 30 / 60 / 90 Day Roadmap</h2>

  {% if trajectory %}
  {% set traj_current = trajectory.current_percent | default(trajectory.current_maturity_percent, true) %}
  {% set traj_30 = trajectory.post_30_day_percent | default(trajectory.projected_30_day_percent, true) %}
  {% set traj_60 = trajectory.post_60_day_percent | default(trajectory.projected_60_day_percent, true) %}
  {% set traj_90 = trajectory.post_90_day_percent | default(trajectory.projected_90_day_percent, true) %}
  <div style="margin-bottom:1rem">
    <h4>Maturity Trajectory</h4>
    <div class="trajectory-bar">
      {% if traj_current is defined and traj_current is not none %}
      <div class="traj-segment" style="width:{{ traj_current }}%;background:var(--warn)">
        {{ traj_current }}% now
      </div>
      {% endif %}
      {% if traj_30 is defined and traj_30 is not none and traj_current is defined and traj_current is not none %}
      <div class="traj-segment" style="width:{{ traj_30 - traj_current }}%;background:var(--accent)">
        {{ traj_30 }}% @ 30d
      </div>
      {% endif %}
      {% if traj_60 is defined and traj_60 is not none and traj_30 is defined and traj_30 is not none %}
      <div class="traj-segment" style="width:{{ traj_60 - traj_30 }}%;background:#5b9bd5">
        {{ traj_60 }}% @ 60d
      </div>
      {% endif %}
      {% if traj_90 is defined and traj_90 is not none and traj_60 is defined and traj_60 is not none %}
      <div class="traj-segment" style="width:{{ traj_90 - traj_60 }}%;background:var(--success)">
        {{ traj_90 }}% @ 90d
      </div>
      {% elif traj_90 is defined and traj_90 is not none and traj_30 is defined and traj_30 is not none %}
      <div class="traj-segment" style="width:{{ traj_90 - traj_30 }}%;background:var(--success)">
        {{ traj_90 }}% @ 90d
      </div>
      {% endif %}
    </div>
    {% if trajectory.controls_resolved_by_phase is defined %}
    <div style="font-size:.75rem;color:var(--muted);margin-top:.3rem">
      Controls resolved: {{ trajectory.controls_resolved_by_phase.get('30_days', 0) }} (30d)
      + {{ trajectory.controls_resolved_by_phase.get('60_days', 0) }} (60d)
      + {{ trajectory.controls_resolved_by_phase.get('90_days', 0) }} (90d)
      = {{ trajectory.controls_resolved_by_phase.get('cumulative_90', 0) }} total
    </div>
    {% endif %}
  </div>
  {% endif %}

  <div class="grid-3">
    {% for phase in roadmap_sections %}
    <div class="phase-card phase-{{ phase.key.replace('_days','') }}">
      <div class="phase-header">{{ phase.label }} &mdash; {{ phase.description }}</div>
      {% if phase.entries %}
        {% for item in phase.entries %}
        <div class="phase-item">
          <div style="display:flex;align-items:center;gap:.5rem;flex-wrap:wrap;margin-bottom:.3rem">
            <strong>{{ item.title }}</strong>
            {% if item.blast_radius %}
            <span class="tag">{{ item.blast_radius }}</span>
            {% endif %}
          </div>
          <div style="display:flex;gap:.8rem;flex-wrap:wrap;font-size:.78rem;color:var(--muted)">
            {% if item.controls_count %}
            <span>&#x1F4CB; {{ item.controls_count }} controls</span>
            {% endif %}
            {% if item.controls_resolved %}
            <span>&#x2705; {{ item.controls_resolved }} resolved</span>
            {% endif %}
            {% if item.risks_reduced %}
            <span>&#x1F6E1;&#xFE0F; Reduces {{ item.risks_reduced }} risk(s)</span>
            {% endif %}
            {% if item.estimated_effort %}
            <span>&#x23F1;&#xFE0F; {{ item.estimated_effort }}</span>
            {% endif %}
            {% if item.owner_role %}
            <span>&#x1F464; {{ item.owner_role }}</span>
            {% endif %}
          </div>
          {% if item.dependencies %}
          <div style="font-size:.75rem;color:var(--muted);margin-top:.3rem">
            Depends on: {{ item.dependencies|join(", ") }}
          </div>
          {% endif %}
          {% if item.success_criteria %}
          <div style="font-size:.75rem;color:var(--muted);margin-top:.2rem">
            &#x2713; {{ item.success_criteria }}
          </div>
          {% endif %}
        </div>
        {% endfor %}
      {% else %}
        <div class="phase-item" style="color:var(--muted)">No initiatives in this phase.</div>
      {% endif %}
    </div>
    {% endfor %}
  </div>
</section>

<!-- ═══════════════ S4  DESIGN AREA BREAKDOWN ═══════════════ -->
<section id="design-areas">
  <h2>&sect; 4 &mdash; Design Area Breakdown</h2>

  {% for area in design_areas %}
  <details {% if loop.index <= 2 %}open{% endif %}>
    <summary>
      <span style="flex:1">{{ area.section }}</span>
      <span class="badge badge-{{ area.confidence|lower }}">{{ area.confidence }} conf</span>
      <span style="font-size:.8rem;color:var(--muted)">
        {{ area.maturity_percent|default('--') }}{% if area.maturity_percent is not none %}%{% endif %} maturity
      </span>
      {% if area.critical_fail_count %}
      <span class="badge badge-fail">{{ area.critical_fail_count }} critical fail</span>
      {% endif %}
      <span style="font-size:.75rem;color:var(--muted)">
        {{ area.controls|length }} controls
      </span>
    </summary>
    <div class="detail-body">
      <!-- Section KPIs -->
      <div class="kpi-row" style="margin-bottom:1rem">
        <div class="kpi">
          <div class="kpi-value" style="color:{% if area.maturity_percent and area.maturity_percent >= 70 %}var(--success){% elif area.maturity_percent and area.maturity_percent >= 40 %}var(--warn){% else %}var(--danger){% endif %}">
            {{ area.maturity_percent|default('--') }}{% if area.maturity_percent is not none %}%{% endif %}
          </div>
          <div class="kpi-label">Maturity</div>
        </div>
        <div class="kpi">
          <div class="kpi-value">{{ area.counts.get('Pass', 0) }}</div>
          <div class="kpi-label">Pass</div>
        </div>
        <div class="kpi">
          <div class="kpi-value" style="color:var(--warn)">{{ area.counts.get('Partial', 0) }}</div>
          <div class="kpi-label">Partial</div>
        </div>
        <div class="kpi">
          <div class="kpi-value" style="color:var(--danger)">{{ area.counts.get('Fail', 0) }}</div>
          <div class="kpi-label">Fail</div>
        </div>
        <div class="kpi">
          <div class="kpi-value" style="color:var(--muted)">{{ area.counts.get('Manual', 0) }}</div>
          <div class="kpi-label">Manual</div>
        </div>
      </div>

      <!-- Controls table -->
      {% if area.controls %}
      <table>
        <thead>
          <tr>
            <th style="width:22%">Control</th>
            <th style="width:7%">Status</th>
            <th style="width:8%">Signal</th>
            <th style="width:7%">Severity</th>
            <th style="width:7%">Confidence</th>
            <th>Why We Think This</th>
          </tr>
        </thead>
        <tbody>
          {% for ctrl in area.controls %}
          <tr>
            <td>
              <span style="font-weight:500">{{ ctrl.text }}</span><br/>
              <span style="font-size:.7rem;color:var(--muted)">{{ ctrl.control_id }}</span>
            </td>
            <td><span class="badge badge-{{ ctrl.status|lower }}">{{ ctrl.status }}</span></td>
            <td><span class="badge badge-{{ ctrl.signal_type|lower }}">{{ ctrl.signal_type }}</span></td>
            <td>
              {% if ctrl.severity %}
              <span class="badge badge-{{ ctrl.severity|lower }}">{{ ctrl.severity }}</span>
              {% else %}
              <span style="color:var(--muted)">&mdash;</span>
              {% endif %}
            </td>
            <td><span class="badge badge-{{ ctrl.confidence|lower }}">{{ ctrl.confidence }}</span></td>
            <td class="why-cell">{{ ctrl.why }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <p style="color:var(--muted)">No controls evaluated in this section.</p>
      {% endif %}
    </div>
  </details>
  {% endfor %}
</section>

<!-- ═══════════════ S5  WORKSHOP DECISION FUNNEL ════════════ -->
<section id="workshop">
  <h2>&sect; 5 &mdash; Workshop Decision Funnel</h2>

  {% if workshop_funnel %}
    {% for domain in workshop_funnel %}
    <div class="funnel-domain">
      <h3>{{ domain.domain }}
        {% if domain.total_controls_impacted %}
        <span class="tag" style="margin-left:.5rem">{{ domain.total_controls_impacted }} controls impacted if implemented</span>
        {% endif %}
      </h3>
      <div class="funnel-cols">
        <!-- Risks column -->
        <div class="funnel-col">
          <h4>&#x1F525; Top Risks</h4>
          {% if domain.risks %}
            {% for r in domain.risks %}
            <div class="funnel-item">
              <span class="badge badge-{{ r.severity|lower }}" style="margin-right:.3rem">{{ r.severity }}</span>
              {{ r.title }}
            </div>
            {% endfor %}
          {% else %}
            <div style="color:var(--muted);font-size:.82rem">None identified</div>
          {% endif %}
        </div>
        <!-- Blockers column -->
        <div class="funnel-col">
          <h4>&#x1F6A7; Blockers</h4>
          {% if domain.blockers %}
            {% for b in domain.blockers %}
            <div class="funnel-item">
              {% if b.severity %}
              <span class="badge badge-{{ b.severity|lower }}" style="margin-right:.3rem">{{ b.severity }}</span>
              {% endif %}
              {{ b.description }}
            </div>
            {% endfor %}
          {% else %}
            <div style="color:var(--muted);font-size:.82rem">None identified</div>
          {% endif %}
        </div>
        <!-- Questions column -->
        <div class="funnel-col">
          <h4>&#x2753; Decision Questions</h4>
          {% if domain.questions %}
            {% for q in domain.questions %}
            <div class="funnel-q">
              <div class="q-text">{{ q.question }}</div>
              <div class="q-meta">
                {% if q.type %}<span class="tag">{{ q.type }}</span>{% endif %}
                {% if q.controls_impacted %}
                <span class="tag">Controls impacted: {{ q.controls_impacted }}</span>
                {% endif %}
              </div>
              {% if q.follow_up %}
              <div class="q-meta" style="margin-top:.2rem">&#x1F4A1; {{ q.follow_up }}</div>
              {% endif %}
              {% if q.impact_if_yes or q.impact_if_no %}
              <div class="impact-row">
                {% if q.impact_if_yes %}
                <span class="impact-yes" style="font-size:.78rem">&#x2705; {{ q.impact_if_yes }}</span>
                {% endif %}
                {% if q.impact_if_no %}
                <span class="impact-no" style="font-size:.78rem">&#x274C; {{ q.impact_if_no }}</span>
                {% endif %}
              </div>
              {% endif %}
            </div>
            {% endfor %}
          {% else %}
            <div style="color:var(--muted);font-size:.82rem">No questions for this area</div>
          {% endif %}
        </div>
      </div>
    </div>
    {% endfor %}
  {% else %}
    <p style="color:var(--muted)">No workshop data available.</p>
  {% endif %}
</section>

</div>

<footer style="text-align:center;padding:2rem 0;color:var(--muted);font-size:.75rem;border-top:1px solid var(--border)">
  Azure Landing Zone Assessment &mdash; CSA Decision-Driven Report
</footer>

</body>
</html>